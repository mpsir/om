import{resolveComponent,openBlock,createBlock,Fragment,createVNode,createCommentVNode,renderSlot,toDisplayString,withDirectives,vModelText,renderList}from"vue";function render_page_object(e,t){var r="";return r+="g.App = Vue.createApp({",e.hasOwnProperty("template")&&(r+="\n\t"+render_template(e.template)+","),e.hasOwnProperty("setup")&&(r+="\n\t"+e.setup+","),e.hasOwnProperty("data")&&(r+="\n\t"+e.data+","),e.hasOwnProperty("computed")&&(r+="\n\t"+e.computed+","),r+="\n})\n",(e.use_quasar||!1)&&(r+="g.App.use(Quasar)\n"),(e.use_vue_shortkey||!1)&&(r+="g.App.use(window['VueShortkey'])\n"),(e.use_vdrag||!1)&&(r+="g.App.use(vdrag, {})\n"),(e.use_DraggableResizable||!1)&&(r+="g.App.use(Vue3DraggableResizable.default)\n"),(e.use_draggable||!1)&&(r+="g.App.component('draggable', vuedraggable)\n"),(e.use_MonacoEditor||!1)&&(r+="g.App.component('monaco-editor', g.comps.MonacoEditor)\n"),(e.use_ToggleContent||!1)&&(r+="g.App.component('toggle-content', g.comps.ToggleContent)\n"),(e.use_db_editor||!1)&&(r+="g.App.component('db-editor', g.comps.DB_Editor)\n"),r+=`${t} = g.App.mount("#app-div")\n`}function render_template(e){var t="template: ";if("string"==typeof e)return t+g.f.string(e);if(Array.isArray(e)){var r="";return e.forEach((e=>{r+=function(e){return"string"==typeof e?g.f.string(e):""}(e)})),t+r}return t+g.f.string("<div>Template-Resove-Type : Unknown</div>")}g.DeleteDb=async function(e=!1){g.db.delete(),e&&location.reload()},g.createApp=async function(e={App:{},VueShortkey:!0,Quasar:!0,vdrag:!0,DraggableResizable:!0,draggable:!0,MonacoEditor:!0,ToggleContent:!0}){var t=Vue.createApp(e.App);return e.VueShortkey&&t.use(window.VueShortkey),e.Quasar&&t.use(Quasar),e.vdrag&&t.use(vdrag,{}),e.DraggableResizable&&t.use(Vue3DraggableResizable.default),e.draggable&&t.component("draggable",vuedraggable),e.MonacoEditor&&t.component("monaco-editor",g.comps.MonacoEditor),e.ToggleContent&&t.component("toggle-content",g.comps.ToggleContent),t.mount("#app-div")},g.GetAppFromDB=async function(e){var t=await g.db.pages.toArray();return t=t.find((function(t){return t.name==e}))},g.AddDB=async function(){var e=await g.Dexie.exists("ShreeRam");g.db=await new g.Dexie("ShreeRam"),g.db.version(1).stores({pages:"++id, &name",comps:"++id, &name",opts:"++id, &name",templates:"++id, &name",js:"++id, &name",css:"++id, &name",images:"++id, &name",blobs:"++id, &name"}),e||g.db.pages.bulkAdd(g.pages)},g.GetRenderPage=function(e,t="g.VApp"){return render_page_object(e,t)},g.pages=[{name:"home",template:['\n    <div class="q-pt-sm">\n      <button class="q-pa-sm q-ma-sm" onclick="g.DeleteDb(true)">Delete Database</button>\n      <div>\n        <db-editor />\n      </div>\n    </div>\n  '],data:"data(){ return {} }",setup:"setup(props, { attrs, slots, emit, expose }) { return { } }",computed:"computed: { g(){ return g } }",use_quasar:!0,use_vue_shortkey:!0,use_vdrag:!0,use_DraggableResizable:!0,use_draggable:!0,use_MonacoEditor:!0,use_ToggleContent:!0,use_db_editor:!0,components:{}},{name:"admin"}];const _sfc_main$4={data:()=>({Value:null,input_type:"string"}),setup:function(e,{attrs:t,slots:r,emit:a,expose:o}){return{editor:{},g:Vue.computed((()=>g))}},props:{modelValue:{type:String,required:!0},language:{type:String,required:!1,default:"json"},format_on_start:{type:Boolean,required:!1,default:!0},IsReadOnly:{type:Boolean,required:!1,default:!0}},emits:["update:modelValue","update"],created(){this.update_modelValue()},watch:{modelValue:{handler(e,t){this.update_modelValue()},deep:!0}},mounted(){var e=this;this.editor=g.monaco.editor.create(this.$refs.m_editor,{value:e.Value,overviewRulerLanes:0,hideCursorInOverviewRuler:!0,language:e.language,readOnly:!1,minimap:{enabled:!1},showFoldingControls:"always",scrollbar:{vertical:"hidden",horizontal:"visible"},overviewRulerBorder:!1}),setTimeout((()=>{this.update_editor()}),100),e.format_on_start&&(setTimeout((()=>{this.editor.getAction("editor.action.formatDocument").run()}),500),this.Value=this.editor.getValue()),this.editor.getModel().onDidChangeContent((t=>{e.update_editor(),e.Value=e.editor.getValue(),e.$emit("update:modelValue",e.Value)}));const t=()=>{this.editor.getContribution("editor.contrib.folding").getFoldingModel().then((t=>{t.onDidChange((()=>{e.Value=e.editor.getValue()}))}))};t(),this.editor.onDidChangeModel(t)},methods:{update_editor:function(){const e=19*this.editor.getModel().getLineCount();$(this.$refs.m_editor).css("height",e+"px"),this.editor.layout(),this.Value=this.editor.getValue()},update_modelValue(){this.Value=this.modelValue;try{this.editor.getModel().setValue(this.modelValue),this.format_on_start&&this.editor.getAction("editor.action.formatDocument").run()}catch(e){}},update_parent(){this.$emit("update",this.Value)}}},_hoisted_1$3={key:0},_hoisted_2$1={style:{border:"1px dashed darkgrey"}},_hoisted_3={ref:"m_editor",style:{"min-height":"28px"}};function _sfc_render$4(e,t,r,a,o,n){const s=resolveComponent("q-btn");return openBlock(),createBlock(Fragment,null,[r.IsReadOnly?createCommentVNode("",!0):(openBlock(),createBlock("div",_hoisted_1$3,[createVNode(s,{onClick:t[1]||(t[1]=e=>n.update_parent()),color:"white","text-color":"black",label:"Update","no-caps":""})])),createVNode("div",_hoisted_2$1,[createVNode("div",_hoisted_3,null,512)])],64)}_sfc_main$4.render=_sfc_render$4;const _sfc_main$3={props:{show_inner_p:{type:Boolean,default:!0,required:!1}},data:()=>({show_inner:!0}),created(){this.show_inner=this.show_inner_p},mounted(){var e=this,t=this.$refs.controls;if((r=$(t).find(".toggle-handle"))[0]){var r=r[0];$(r).click((function(){e.show_inner=!e.show_inner}))}else console.log("no handle found",'\nadd "toggle-handle" class to any ui element.')}},_hoisted_1$2={ref:"controls"};function _sfc_render$3(e,t,r,a,o,n){return openBlock(),createBlock(Fragment,null,[createVNode("span",_hoisted_1$2,[renderSlot(e.$slots,"control")],512),o.show_inner?renderSlot(e.$slots,"default",{key:0}):createCommentVNode("",!0)],64)}_sfc_main$3.render=_sfc_render$3;const _sfc_main$2={props:{page_id:{type:Number,required:!0}},methods:{update_page(){var e=g.f.pstring(this.page[0]);g.db.pages.put(e)}},data(){return{page:g.f.live_data((()=>db.pages.filter((e=>e.id==this.page_id)).toArray()))}},computed:{g:()=>g},components:{}},_hoisted_1$1={style:{margin:"8px"}},_hoisted_2={key:0},_hoisted_4={key:1},_hoisted_5={key:1};function _sfc_render$2(e,t,r,a,o,n){return openBlock(),createBlock(Fragment,null,[createVNode("div",_hoisted_1$1," page "+toDisplayString(r.page_id),1),Array.isArray(o.page)&&o.page.length?(openBlock(),createBlock("div",_hoisted_2,[createCommentVNode("",!0),Array.isArray(o.page[0].template)?(openBlock(),createBlock("div",_hoisted_4,[createVNode("div",null,[createVNode("button",{class:"q-pa-sm",onClick:t[1]||(t[1]=(...e)=>n.update_page&&n.update_page(...e))}," update page template "),withDirectives(createVNode("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.page[0].template[0]=e),style:{width:"100%"}},null,512),[[vModelText,o.page[0].template[0]]])])])):createCommentVNode("",!0)])):(openBlock(),createBlock("div",_hoisted_5," data fetching ... "))],64)}_sfc_main$2.render=_sfc_render$2;const _sfc_main$1={props:{},data:()=>({pages:g.f.live_data((()=>db.pages.toArray()))}),components:{"edit-page":_sfc_main$2}},_hoisted_1={style:{margin:"8px"}};function _sfc_render$1(e,t,r,a,o,n){const s=resolveComponent("edit-page");return openBlock(!0),createBlock(Fragment,null,renderList(o.pages,((e,t)=>(openBlock(),createBlock("div",_hoisted_1,[createVNode(s,{page_id:o.pages[t].id},null,8,["page_id"])])))),256)}_sfc_main$1.render=_sfc_render$1;const _sfc_main={props:{},data:()=>({}),components:{"db-pages":_sfc_main$1}};function _sfc_render(e,t,r,a,o,n){const s=resolveComponent("db-pages");return openBlock(),createBlock("div",null,[createVNode(s)])}_sfc_main.render=_sfc_render,g.comps=g.comps||{},g.comps.MonacoEditor=_sfc_main$4,g.comps.ToggleContent=_sfc_main$3,g.comps.DB_Editor=_sfc_main,g.d={},g.r=Vue.reactive({funs:{type:"Script",body:[{type:"ast-string"}]}}),g.f={pstring:e=>JSON.parse(JSON.stringify(e)),string:e=>JSON.stringify(e),parse:e=>JSON.parse(e),is_local_host:function(){return"8080"==location.port||"3000"==location.port},add_socket(){var e={},t=!1;g.f.is_local_host()?(e=io("http://localhost:8080/"),t=!0):"mpsir.github.io"!=location.host&&(e=g.io("http://super1mpsir-57484.portmap.host:57484/"),t=!0),t&&e.on("connect",(()=>{}))},live_data:e=>VueUse.useObservable(Dexie.liveQuery(e)),get_page_name(){var e=location.search;if(""==e)return"home";const t=new URLSearchParams(e).get("page");return t||"home"},async update(){g.App&&(g.App.unmount(),g.r.current_page_name=g.f.get_page_name(),g.r.current_page_object=await g.GetAppFromDB(g.r.current_page_name),g.r.current_page_result=g.GetRenderPage(g.r.current_page_object,"g.VApp"),console.log("g.r.current_page_result\n",g.r.current_page_result),eval(g.r.current_page_result))},start:async function(){g.f.add_socket(),await g.AddDB();var a=await Dexie.liveQuery((()=>db.pages.toArray()));a.subscribe((function(e){g.f.update()})),g.r.current_page_name=g.f.get_page_name(),g.r.current_page_object=await g.GetAppFromDB(g.r.current_page_name),g.r.current_page_result=g.GetRenderPage(g.r.current_page_object,"g.VApp"),console.log("g.r.current_page_result\n",g.r.current_page_result),eval(g.r.current_page_result)}};
