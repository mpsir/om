var zim=function(t){return t.LeaderBoard=function(e,o,n,r,i,a,l,c,u,d,f,h,m,g,w,v,z,b,C,y,k,x,T,R,I){var E;if(E=zob(t.LeaderBoard,arguments,null,this))return E;if(this.arguments=arguments,zot(e)&&(e="localStorage"),zot(n)&&(n=400),zot(r)&&(r=600),this.super_constructor(n,r),zot(i)&&(i=20),zot(a)&&(a="white"),zot(l)&&(l="#222"),zot(u)&&(u=10),zot(d)&&(d=300),zot(f)&&(f=6),zot(h)&&(h=!1),zot(m)&&(m=10),zot(g)&&(g=!1),!zot(w)&&zot(v)&&(v=2),zot(z)&&(z="rgba(0,0,0,.3)"),zot(b)&&(b=14),zot(C)&&(C=!1),zot(y)&&(y=!1),zot(k)&&(k="courier"),zot(x)&&(x=60),zot(T)&&(T=0),zot(R)&&(R=0),zot(I)&&(I=0),void 0===O||zot(O))var O=zimDefaultFrame;var A=this.backing=new t.Rectangle(n,r,a,w,v,i);A.mouseEnabled=!1;var P=A.on("click",function(){});if(A.off("click",P),A.off("click",P),this.addChild(A),this.setBounds(0,0,n,r),this.backdrop=new Rectangle(2e3,1e3,"rgba(0,0,0,.01)").center(this,0),void 0===O&&"undefined"!=typeof zimDefaultFrame)O=zimDefaultFrame;var D=O.stage;this.backdrop.on("mousedown",function(){D=_.stage,_.removeFrom(),_.dispatchEvent("close"),D&&D.update()}),this.filled=!1,this.info={reverse:C,total:u,allowZero:y,type:j},-1!=z&&b>0&&(A.shadow=new createjs.Shadow(z,3,3,b));var S,L,B,F,j,M,U,N,X=this.grid=new t.Container,_=this,K={rankBackgroundColor:t.darker,rankColor:t.light,currentRankBackgroundColor:t.pink,currentRankColor:"white",nameBackgroundColor:t.lighter,nameColor:t.darker,currentNameBackgroundColor:"#f0d2e8",currentNameColor:t.darker,scoreBackgroundColor:t.light,scoreColor:t.darker,currentScoreBackgroundColor:"#f0d2e8",currentScoreColor:t.darker},V=(K=t.merge(K,c),t.decimals(8,-f,!0));if("localStorage"==e)Y();else if(Array.isArray(e))_.dataSource="custom",Z();else{_.dataSource="database",_.key=e,t.async("https://zimjs.com/gamedata.php?id="+e,function(t){if("error"==t){var o=new createjs.Event("error");return o.type="data",_.dispatchEvent(o),void Y()}"noscores"==t&&(t=[]);e=t,Z()})}function Y(){_.dataSource="localStorage",e=localStorage&&localStorage.gameData?JSON.parse(localStorage.gameData):[],Z()}function Z(){if(H=_.scaleX,_.sca(1),_.filled=!1,O.off("keydown",N),!zot(o)){var n=_.titleText=new t.Label({text:o,size:x,color:l,align:"center",font:k}).addTo(X);n.x=n.width/2,n.mouseEnabled=!1}var r;zot(_.winner)||(F=[]),A.mouseEnabled=!1,A.off("click",P);for(var i=0;i<u;i++){r=i==_.winner,e[i]?(p=e[i].player,s=e[i].score):p=s="   ",S=new t.Container,(B=new t.Label({text:i+1,size:50,color:i==_.winner?K.currentRankColor:K.rankColor,align:"center",valign:"center",backing:new t.Rectangle(100,100,r?K.currentRankBackgroundColor:K.rankBackgroundColor)})).reg(-B.width/2,-B.height/2),B.label.regY=-I,B.addTo(S),g&&!zot(_.winner)&&B.mov(0,i>=_.winner?50:0).mov(0,i>_.winner?50:0);for(var a=0;a<3;a++){L=new t.Stepper({list:r?"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-*_".split(""):p[a],width:100,continuous:!0,label:new t.Label({text:"",font:k,color:i==_.winner?K.currentNameColor:K.nameColor,size:x+4,align:"center",shiftVertical:-6+T}),backgroundColor:r?K.currentNameBackgroundColor:K.nameBackgroundColor,vertical:!1,arrows:!1,arrows2:r&&g,corner:0,shadowBlur:0}),r&&(A.mouseEnabled=!0,A.on("click",P),O.tabOrder&&O.tabOrder.push(L),F.push(L),L.currentValue="_",L.on("change",function(){t.loop(F,function(t){if("_"==t.currentValue)return!0})||(_.filled=!0,w.text="",M.addTo(U),_.stage&&_.stage.update()),_.dispatchEvent("change")}),0==a&&(L.keyFocus=!0)),L.x=B.width+m+a*(L.width+m),g&&!zot(_.winner)&&L.mov(0,i>=_.winner?50:0).mov(0,i>_.winner?50:0),S.addChild(L);var c=new t.Label({text:V,color:r?K.currentScoreColor:K.scoreColor,font:k,size:x+4,align:"right",valign:"center",backing:new t.Rectangle(d,100,r?K.currentScoreBackgroundColor:K.scoreBackgroundColor)});c.text=h?t.decimals(s,-f,!0):s,c.reg(-c.width/2,-c.height/2),c.label.regY=-4-R,c.label.skewX=10,S.addChild(c),c.x=B.width+m+3*(L.width+m)+60,g&&!zot(_.winner)&&c.mov(0,i>=_.winner?50:0).mov(0,i>_.winner?50:0)}if(r){U=S;var w=c;(M=_.button=new t.Button({label:new t.Label({text:"SAVE",size:50,align:"center",color:K.currentRankColor,rollColor:K.currentRankBackgroundColor}),width:c.width,backgroundColor:K.currentRankBackgroundColor,rollBackgroundColor:K.currentRankColor,height:100,corner:0,shadowBlur:0})).x=c.x-60,M.y=c.y,O.tabOrder&&O.tabOrder.push(M),M.on("mousedown",_.submitScore),N=O.on("keydown",function(t){_.stage&&M.focus&&13==t.keyCode&&(submitScore(),t.preventDefault())})}S.addTo(X),S.x=0,S.y=(zot(o)?0:n.height+2*m)+i*(100+m),S.mouseChildren=r,S.mouseEnabled=r}zot(o)||(n.center(X),n.y=0),X.scaleTo(_,95,95).center(_),_.sca(H),D&&D.update()}function j(t){var o;"error"==t?((o=new createjs.Event("error")).type="save",_.dispatchEvent(o),M.text="ERROR",e.splice(_.pendingIndex,1)):((o=new createjs.Event("save")).data=e=t,_.dispatchEvent(o),M.text="DONE");_.pendingIndex=null,_.stage&&_.stage.update(),setTimeout(function(){_.redraw()},1e3)}function G(t){}this.submitScore=function(){M.text="localStorage"==_.dataSource?"LOCAL":"SENT",U.mouseChildren=!1,U.mouseEnbabled=!1,_.stage.update(),zot(e[_.winner])&&(e[_.winner]={}),e[_.winner].player=F[0].currentValue+F[1].currentValue+F[2].currentValue;var o=new createjs.Event("press"),n=(o.player=e[_.winner].player,o.score=e[_.winner].score);o.key=_.key,o.info=_.info,_.dispatchEvent(o),"custom"!=_.dataSource&&t.decimals(n,null,null,null,null,null,o)&&_.save()},this.score=function(o){zog("yasdf"),zot(_.pendingIndex)||_.cancel();var n=t.loop(e,function(t,n){if(!C&&t.score<=o||C&&t.score>=o)return e.splice(n,0,{player:"",score:o}),n});return zot(n)&&(y||o>0)&&(0==e.length||e.length<u)&&(e.push({player:"",score:o}),n=e.length-1),zot(n)||(_.pendingIndex=n,_.redraw(null,n)),n},this.save=function(){if(zot(_.pendingIndex))return _;if("database"==_.dataSource){var o=e[_.pendingIndex].player,n=e[_.pendingIndex].score;t.async("https://zimjs.com/gamedata.php?id="+_.key+"&player="+o+"&score="+n+"&reverse="+C+"&total="+u+"&allowZero="+y,j)}return"localStorage"==_.dataSource&&(_.pendingIndex=null,localStorage&&(localStorage.gameData=JSON.stringify(e)),setTimeout(function(){M.text="DONE",_.stage&&_.stage.update()},500),setTimeout(function(){_.redraw()},1500)),_},this.startTime=function(){t.async("https://zimjs.com/gamedata.php?id="+_.key+"&command=start",G)},this.stopTime=function(){t.async("https://zimjs.com/gamedata.php?id="+_.key+"&command=stop",G)},this.cancel=function(){if(zot(_.pendingIndex))return _;e.splice(_.pendingIndex,1),_.pendingIndex=null,_.redraw();var t=new createjs.Event("cancel");return t.data=e,_.dispatchEvent(t),_};var H=_.scaleX;this.redraw=function(t,o){return t&&(e=t),H=_.scaleX,_.dispose(),zot(o)?_.winner=null:_.winner=o,X.removeAllChildren(),Z(),_.stage&&_.stage.update(),_},this.dispose=function(){var e;F&&(t.loop(F,function(t){if(O.tabOrder){var e=O.tabOrder.indexOf(t);e>-1&&O.tabOrder.splice(e,1)}t.dispose()}),O.tabOrder&&(e=O.tabOrder.indexOf(M))>-1&&O.tabOrder.splice(e,1),M&&M.dispose())}},t.extend(t.LeaderBoard,t.Container),t.Meter=function(e,o,n,r,i,a,l,s,c){var u;if(u=zob(t.Meter,arguments,null,this))return u;this.arguments=arguments,zot(o)&&(o="bottom"),zot(n)&&(n="left"),zot(a)&&(a=20),zot(l)&&(l=0),zot(r)&&(r="#acd241"),zot(i)&&(i="black"),zot(s)&&(s=.6),zot(c)&&(c=10),this.super_constructor(null,30,null,i,null,null,null,"center","center",null,null,null,null,null,new t.Rectangle(100,40,r));var d,f,h=this;zot(e)?f=h.on("added",m):m();var p=new t.Label({text:"FPS",size:18,color:i}).rot(-90).addTo(h).alp(.5);function m(){zot(e)&&(e=h.stage),zot(e)||(h.off("added",f),e.addChild(h),h.alpha=s,h.skewX=c,h.setBounds(null),h.pos(a,a,n,o),d=t.Ticker.add(function(){h.text=t.decimals(createjs.Ticker.getMeasuredFPS(),l,!0),e&&e.update()},e))}p.x=59,p.y=17,this.position=function(t,e){zot(t)||(o=t),zot(e)||(n=e),h.setBounds(null),h.pos(a,a,n,o)},this.dispose=function(){t.Ticker.remove(d)}},t.extend(t.Meter,t.Label),t.Board=function(e,o,n,r,i,a,l,s,c,u,d,f,h,p,m,g,w,v,z,b,C,y,k,v,x){var T;if(T=zob(t.Board,arguments,null,this))return T;this.arguments=arguments,zot(e)&&(e=50),this.size=e,zot(o)&&(o=zot(n)?8:n),zot(n)&&(n=o),this.cols=o,this.rows=n,this.num=o*n,zot(r)&&(r="#eee"),zot(i)&&(i="#aaa"),zot(a)&&(a="#111"),zot(l)&&(l=2),zot(c)&&(c=!0);var R=c;zot(u)&&(u=null),zot(d)&&(d="#111"),zot(f)&&(f=2),zot(p)&&(p="circle"),"circle"!=p&&(p="rectangle"),zot(h)&&(h="rectangle"==p?e-f:e/4),zot(m)&&(m=!0),zot(g)&&(g="rgba(0,0,0,.4)"),zot(w)&&(w="#fff"),zot(v)&&(v=m);var I="undefined"==typeof TIME?"seconds":TIME;function E(){z=[],t.loop(n,function(e){var n=z[e]=[];t.loop(o,function(t){n[t]={data:"x",color:r,icon:s?s.clone():null,items:[]}})})}if(zot(z))E();else if("string"==typeof z)z.match(/zimon/)&&"undefined"!=typeof ZIMON?z=ZIMON.parse(z):E();else if(Array.isArray(z)&&0!=z.length){info2=[];var O=0;t.loop(Math.max(o,z.length),function(t){z[t]&&z[t].length>O&&(O=z[t].length)}),t.loop(Math.max(o,z.length),function(e){var o=info2[e]=[];t.loop(Math.max(n,O),function(t){z[e]&&!zot(z[e][t])?(zot(z[e][t].data)&&(z[e][t].data="x"),zot(z[e][t].color)&&(z[e][t].color=r),zot(z[e][t].icon)&&(z[e][t].icon=s?s.clone():null),zot(z[e][t].items)&&(z[e][t].items=[]),o[t]=z[e][t]):o[t]={data:"x",color:r,icon:s?s.clone():null,items:[]}})}),z=copy(info2)}else E();this.info=z,zot(b)&&(b=!1),zot(C)&&(C="#666"),zot(y)&&(y=1.2),zot(k)&&(k=1.8),zot(v)&&(v=!0),zot(x)&&(x=2),this.super_constructor(),this.type="Board",this.buffer=x;var A=this,P=(new t.Container).addTo(this),D=new t.Container(e,e);new t.Rectangle(e,e,zik(r),zik(a),zik(l)).addTo(D),b&&new t.Label({text:"",color:C,align:"center",valign:"center"}).center(D),tiles=this.tiles=new t.Tile(D.centerReg(),o,n),c?(tiles.rot(45).centerReg(P),P.sca(2,1)):tiles.centerReg(P),this.arrows=m;var S=0,L=0,B=0,F=0;function j(){A.arrowLeft&&A.arrowRight&&(A.arrowLeft.removeAllEventListeners(),A.arrowRight.removeAllEventListeners(),A.arrowLeft.removeFrom(),A.arrowLeft=null,A.arrowRight.removeFrom(),A.arrowRight=null)}function M(){A.arrowUp&&A.arrowDown&&(A.arrowUp.removeAllEventListeners(),A.arrowDown.removeAllEventListeners(),A.arrowUp.removeFrom(),A.arrowUp=null,A.arrowDown.removeFrom(),A.arrowDown=null)}function U(e){A.timeout=t.timeout("seconds"==I?.05:50,function(){A.currentTile=null,A.lastTile=null,A.dispatchEvent("change")}),e.target&&e.target.getChildAt&&(e.target.getChildAt(0).color=e.target.lastColor),A.lastTile&&(A.lastTile.getChildAt(0).color=A.lastTile.lastColor),A.stage&&A.stage.update()}function N(e){if(e.constructor!={}.constructor)return e={data:Array.isArray(e)?e:[e]};var o=["data","notData","color","notColor","icon","notIcon","item","notItem","col","notCol","row","notRow"];return t.loop(["datas","notDatas","colors","notColors","icons","notIcons","items","notItems","cols","notCols","rows","notRows"],function(t,n){e[t]&&(e[o[n]]=e[t]),delete e[t]}),t.loop(o,function(t){zot(e[t])||Array.isArray(e[t])||(e[t]=[e[t]])}),e}function X(e,o,n){if(!zot(n.data)&&-1==n.data.indexOf(A.info[o][e].data))return!1;if(!zot(n.notData)&&-1!=n.notData.indexOf(A.info[o][e].data))return!1;if(!zot(n.color)&&-1==n.color.indexOf(A.info[o][e].color))return!1;if(!zot(n.notColor)&&-1!=n.notColor.indexOf(A.info[o][e].color))return!1;if(!(zot(n.icon)||A.info[o][e].icon&&-1!=n.icon.indexOf(A.info[o][e].icon.type)))return!1;if(!zot(n.notIcon)&&A.info[o][e].icon&&-1!=n.notIcon.indexOf(A.info[o][e].icon.type))return!1;if(!zot(n.item)||!zot(n.notItem)){var r=A.getItems(e,o);if(!zot(n.item))if(!t.loop(r,function(t){if(-1!=n.item.indexOf(t))return!0}))return!1;if(!zot(n.notItem))if(t.loop(r,function(t){if(-1!=n.notItem.indexOf(t))return!0}))return!1}return!(!zot(n.col)&&-1==n.col.indexOf(e-S))&&(!(!zot(n.row)&&-1==n.row.indexOf(o-L))&&(!(!zot(n.notCol)&&-1!=n.notCol.indexOf(e-S))&&!(!zot(n.notRow)&&-1!=n.notRow.indexOf(o-L))))}function _(e,o,n){t.loop(n.boardPath,function(t){e&&(t.x=t.x+e),o&&(t.y=t.y+o)}),A.showPath(n.boardPath)}Object.defineProperty(this,"numCols",{get:function(){return A.info[0].length},set:function(t){zog("zim.Board() - numCols is read only")}}),Object.defineProperty(this,"numRows",{get:function(){return A.info.length},set:function(t){zog("zim.Board() - numRows is read only")}}),Object.defineProperty(this,"startCol",{get:function(){return S},set:function(e){(S=t.constrain(e,0,A.numCols-o))!=B&&(A.update(),A.shiftPath(B,S)),B=S}}),Object.defineProperty(this,"startRow",{get:function(){return L},set:function(e){(L=t.constrain(e,0,A.numRows-n))!=F&&(A.update(),A.shiftPath(null,null,F,L)),F=L}}),Object.defineProperty(this,"data",{get:function(){var e=[];return t.loop(L+n,function(n){var r=[];e.push(r),t.loop(S+o,function(t){r.push(A.info[n][t].data)},null,null,S)},null,null,L),e},set:function(t){zog("zim.Board() - data is read only - use setData(tile) or change info property and update()")}}),Object.defineProperty(this,"isometric",{get:function(){return c},set:function(e){if(e!=c){if(c=e,A.removeArrows(),c){P.removeAllChildren(),A.tiles.rot(45).centerReg(P);var o=R?1:1.2;P.sca(2/o,1/o).mov(0,R?20:0)}else P.removeAllChildren(),A.tiles.rot(0).centerReg(P),P.sca(1*(R?1.2:1)).mov(0,R?-20:0);if(v){var n={left:"right",right:"left",up:"down",down:"up"};A.swipeEvent&&A.swipe.off("swipe",A.swipeEvent),A.swipe=new t.Swipe(A,null,null,c),A.swipeEvent=A.swipe.on("swipe",function(t){"none"!=t.target.direction&&A.moveCamera(n[t.target.direction])})}A.setArrows(),A.update(),A.stage&&A.stage.update()}}}),this.update=function(){return b&&tiles.loop(function(t){t.getChildAt(1).text=A.getData(t)}),A.pieces.loop(function(t){t.visible=!1}),A.clearBoardColors(),A.clearBoardIcons(),t.loop(n+L,function(e){t.loop(o+S,function(o){var n=A.info[e][o],r=A.getTile(o-S,e-L);A.setColor(r,n.color,!0),n.icon&&A.setIcon(r,n.icon,!0),t.loop(n.items,function(t){A.add(t,o-S,e-L,null,null,null,!0)})},null,null,S)},null,null,L),A.stage&&A.stage.update(),A},v&&(this.swipe=new t.Swipe(this,null,null,c),this.swipeEvent=this.swipe.on("swipe",function(t){if("none"!=t.target.direction){A.moveCamera({left:"right",right:"left",up:"down",down:"up"}[t.target.direction])}})),this.moveCamera=function(t){return"left"==t?(A.arrowRight&&S==A.numCols-o&&A.arrowRight.hov(w),A.startCol=S-1,A.arrowLeft&&0==S&&A.arrowLeft.hov(-1)):"right"==t?(A.arrowLeft&&0==S&&A.arrowLeft.hov(w),A.startCol=S+1,A.arrowRight&&S==A.numCols-o&&A.arrowRight.hov(-1)):"up"==t?(A.arrowDown&&L==A.numRows-n&&A.arrowDown.hov(w),A.startRow=L-1,A.arrowUp&&0==L&&A.arrowUp.hov(-1)):"down"==t&&(A.arrowUp&&0==L&&A.arrowUp.hov(w),A.startRow=L+1,A.arrowDown&&L==A.numRows-n&&A.arrowDown.hov(-1)),A},this.positionBoard=function(t,e){return A.startCol=t,A.startRow=e,A.arrows&&A.setArrowHover(),A},this.setArrowHover=function(){A.arrowLeft&&A.arrowLeft.hov(0==S?-1:w),A.arrowRight&&A.arrowRight.hov(S==A.numCols-o?-1:w),A.arrowUp&&A.arrowUp.hov(0==L?-1:w),A.arrowDown&&A.arrowDown.hov(L==A.numRows-n?-1:w)},this.addCol=function(e){return zot(e)&&(e=A.numCols),t.loop(A.info,function(t,o){t.splice(e,0,{data:"x",color:r,icon:s?s.clone():null,items:[]})}),A.arrows&&(A.setArrows(),A.setArrowHover()),A.update(),A},this.addRow=function(e){zot(e)&&(e=A.numRows);var o=[];return t.loop(A.numCols,function(){o.push({data:"x",color:r,icon:s?s.clone():null,items:[]})}),A.info.splice(e,0,o),A.arrows&&(A.setArrows(),A.setArrowHover()),A.update(),A},this.setArrows=function(){A.arrows&&(A.info.length>n||A.info[0].length>o?A.arrowUp||(A.arrowUp=new Triangle({color:g}).sca(.4).center(P),c?A.arrowUp.rot(45).mov(tiles.width/2,tiles.width/2-50):A.arrowUp.mov(tiles.width/2+40,-30),A.arrowDown=new Triangle({color:g}).sca(.4).center(P),c?A.arrowDown.rot(-135).mov(tiles.width/2-50,tiles.width/2):A.arrowDown.rot(-180).mov(tiles.width/2+10,30),A.arrowUp.on("mousedown",function(){A.moveCamera("up")}),A.arrowDown.on("mousedown",function(){A.moveCamera("down")})):A.arrowUp&&M(),"yes"==t.loop(A.info,function(t){if(t.length>o)return"yes"})?(A.arrowLeft||(A.arrowLeft=new Triangle({color:g}).sca(.4).cur().center(P),c?A.arrowLeft.rot(-45).mov(-tiles.width/2,tiles.width/2-50):A.arrowLeft.rot(-90).mov(-60,tiles.width/2+40),A.arrowRight=new Triangle({color:g}).sca(.4).center(P),A.arrowRight.n="b",c?A.arrowRight.rot(135).mov(-tiles.width/2+50,tiles.width/2):A.arrowRight.rot(90).mov(0,tiles.width/2+10),A.arrowLeft.on("mousedown",function(){A.moveCamera("left")}),A.arrowRight.on("mousedown",function(){A.moveCamera("right")})),A.setArrowHover()):A.arrowLeft&&j())},A.setArrows(),this.removeArrows=function(){j(),M()},A.lastTile=null,tiles.tap(function(t){A.currentTile=t.target}),tiles.on("mouseover",function(t){A.timeout&&A.timeout.clear(),t.target.lastColor=t.target.getChildAt(0).color,t.target.getChildAt(0).color=i,A.currentTile=t.target,t.target!=A.lastTile&&A.dispatchEvent("change"),A.lastTile=t.target,A.stage&&A.stage.update()}),tiles.on("mouseout",U),zimDefaultFrame.canvas.addEventListener("mouseleave",U),this.getIndexes=function(t){var e=tiles.getChildIndex(t);return{col:e%o,row:Math.floor(e/o)}},this.getInfo=function(t,e){if(!zot(t)){if(zot(e)){var o=A.getIndexes(t);t=o.col+S,e=o.row+L}if(!(t<0||t>A.numCols-1||e<0||e>A.numRows-1))return A.info[e][t]}},this.getData=function(t,e){if(!zot(t))return A.getInfo(t,e).data},this.getColor=function(t,e){if(!zot(t))return A.getInfo(t,e).color},this.getIcon=function(t,e){if(!zot(t))return A.getInfo(t,e).icon},this.getItems=function(t,e){if(!zot(t))return A.getInfo(t,e)?A.getInfo(t,e).items:void 0},this.getAllItems=function(e){var o=[];return e=zot(e)?{}:N(e),t.loop(A.info,function(n,r){t.loop(n,function(n,i){X(i,r,e)&&t.loop(n.items,function(t){o.push(t)})})}),o},this.getTilesAround=function(t,e){if(!zot(t)){if(zot(e)){var o=A.getIndexes(t);t=o.col+S,e=o.row+L}return t<0||t>A.numCols-1||e<0||e>A.numRows-1?[]:[A.getTile(t-1,e-1),A.getTile(t-0,e-1),A.getTile(t+1,e-1),A.getTile(t+1,e-0),A.getTile(t+1,e+1),A.getTile(t-0,e+1),A.getTile(t-1,e+1),A.getTile(t-1,e-0)]}},tiles.loop(function(t){if("circle"==p)t.indicator=new Circle(zik(h),zik(u),zik(d),f).center(t).alp(0);else{var e=zik(h);t.indicator=new Rectangle(e,e,zik(u),zik(d),f).centerReg(t).alp(0)}t.mouseChildren=!1;var o=A.getIndexes(t);t.boardCol=o.col,t.boardRow=o.row;var n=A.getInfo(t).icon;t.icon=n,n&&n.center(t.getChildAt(0))}),this.getTile=function(t,e){if(!(t<0||e<0||t>A.cols-1||e>A.rows-1))return tiles.getChildAt(e*o+t)},this.setData=function(t,e){return A.getInfo(t).data=e,A.data},this.setColor=function(t,e,o){return t.lastColor=t.getChildAt(0).color=e,zot(o)&&(A.getInfo(t).color=e),A},this.setIcon=function(t,e,o){if(!zot(e))return zot(o)&&(A.getInfo(t).icon=e),t.icon&&t.icon.removeFrom(),t.icon=e,e.center(t.getChildAt(0)),A},this.clearInfo=function(e){e=zot(e)?{}:N(e),t.loop(A.info,function(o,n){t.loop(o,function(o,i){if(X(i,n,e)){o.data="x",t.loop(o.items,function(t){t.boardCol=null,t.boardRow=null,t.tile=null,t.removeFrom()}),o.items=[],o.icon=A.icon?A.icon.clone():null,o.color=r;var a=A.getTile(i-S,n-L);a&&(a.getChildAt(0).color=r,o.icon&&o.icon.center(a.getChildAt(0)))}})})},this.clearData=function(e){e=zot(e)?{}:N(e),t.loop(A.info,function(o,n){t.loop(o,function(t,o){X(o,n,e)&&(t.data="x")})})},this.clearItems=function(e){e=zot(e)?{}:N(e),t.loop(A.info,function(o,n){t.loop(o,function(o,r){X(r,n,e)&&(t.loop(o.items,function(t){t.boardCol=null,t.boardRow=null,t.tile=null,t.removeFrom()}),o.items=[])})})},this.clearColors=function(e){e=zot(e)?{}:N(e),t.loop(A.info,function(o,n){t.loop(o,function(t,o){if(X(o,n,e)){t.color=r;var i=A.getTile(o-S,n-L);i&&(i.getChildAt(0).color=r)}})})},this.clearBoardColors=function(){t.loop(tiles,function(t){t.getChildAt(0).color=r})},this.clearIcons=function(e){e=zot(e)?{}:N(e),t.loop(A.info,function(o,n){t.loop(o,function(t,o){if(X(o,n,e)){t.icon&&(t.icon.removeFrom(),t.icon.dispose&&t.icon.dispose(),t.icon=null),t.icon=A.icon?A.icon.clone():null;var r=A.getTile(o-S,n-L);r&&t.icon&&t.icon.center(r.getChildAt(0))}})})},this.clearBoardIcons=function(){t.loop(tiles,function(t){t.icon&&t.icon.removeFrom(),t.icon=null})},this.getRandomTile=function(e){var r;e=zot(e)?{}:N(e);for(var i=0;!r&&i<1e4;){var a=t.rand(0,o-1)+S,l=t.rand(0,n-1)+L;e&&X(a,l,e)&&(r=A.getTile(a-S,l-L)),i++}return r},this.getPoint=function(t,o){if(!zot(t))return zot(o)?tiles.localToLocal(t.x,t.y,A.pieces):tiles.localToLocal((t-S)*e+e/2,(o-L)*e+e/2,A.pieces)},this.getGlobalPoint=function(t,o){if(!zot(t))return zot(o)?tiles.localToGlobal(t.x,t.y):tiles.localToGlobal((t-S)*e+e/2,(o-L)*e+e/2)},this.pieces=(new Container).addTo(this),this.pieces.mouseChildren=!1,this.pieces.mouseEnabled=!1,this.setDepth=function(){var t=[];A.pieces.loop(function(e){t.push(e)}),t.sort(function(t,e){return t.y-e.y}),loop(t,function(t){t.addTo(A.pieces)})},this.position=function(e,r,i,a){r<0||r>o-1||i<0||i>n-1?e.visible=!1:"Emitter"==e.type?e.particles.visible=!0:e.visible=!0;var l=S+r,s=L+i;l=t.constrain(l,0,A.numCols),s=t.constrain(s,0,A.numRows);var u=this.getTile(l-S,s-L);return a?e.boardItems=A.getItems(l,s):(e.boardItems&&e.boardItems.splice(e.boardItems.indexOf(e),1),e.boardItems=A.getItems(l,s),e.boardItems&&e.boardItems.push(e)),e.loc(A.getPoint(l,s),null,A.pieces),u&&(c&&e.sca(e.proportion.convert(e.y)*e.startScaleX,e.proportion.convert(e.y)*e.startScaleY),A.setDepth()),e.boardCol=l-S,e.boardRow=s-L,e.boardTile=u,e.square=s+"-"+l,e.dispatchEvent&&e.dispatchEvent("positioned"),this},this.add=function(t,e,o,n,r,i,a){t.addTo(this.pieces),t.startScaleX||(t.startScaleX=t.scaleX,t.startScaleY=t.scaleY),c&&zot(t.proportion)&&(t.proportion=new Proportion(-P.height/2,P.height/2,y,k)),A.position(t,e,o,a);var l=A.getTile(e,o);return zot(n)||A.setData(l,n),zot(r)||A.setColor(l,r),zot(i)||A.setIcon(l,i),c&&!t.boardEvent&&(t.boardEvent=t.on("animation",function(){t.visible&&t.sca(t.proportion.convert(t.y)*t.startScaleX,t.proportion.convert(t.y)*t.startScaleY),t.dispatchEvent&&t.dispatchEvent("moving")})),this},this.remove=function(t){return"Emitter"==t.type?t.particles.visible=!0:t.visible=!0,t.removeFrom(),t.boardKeyType&&A.removeKeys(t.boardKeyType),t.boardItems&&t.boardItems.splice(t.boardItems.indexOf(t),1),this},A.update(),this.moveTo=function(t,e,o,n,r){return this.move(t,e-t.boardCol,o-t.boardRow,n,r),A},this.move=function(e,r,i,a,l){zot(r)&&(r=0),zot(i)&&(i=0),zot(a)&&(a="seconds"==I?.5:500),e.visible=!0;var s=t.constrain(e.boardCol+r,0,o-1),c=t.constrain(e.boardRow+i,0,n-1);if(!A["keyFilter"+l]||X(s+S,c+L,A["keyFilter"+l])){A.path&&A.clearPath(),total=Math.abs(s-e.boardCol)+Math.abs(c-e.boardRow);var u=this.getPoint(this.getTile(s,c));return e.boardCol==s&&e.boardRow==c||(e.nextCol=s,e.nextRow=c,e.dispatchEvent&&e.dispatchEvent("movingstart"),e.animate({props:{x:u.x,y:u.y},time:a*total,protect:!0,call:function(){if(A.buffer&&A.buffer>0)var t=e.boardCol>s&&e.boardCol<=A.buffer,r=e.boardCol<s&&o-e.boardCol-1<=A.buffer,i=e.boardRow>c&&e.boardRow<=A.buffer,a=e.boardRow<c&&n-e.boardRow-1<=A.buffer;A.position(e,s,c),A.buffer&&A.buffer>0&&(t&&A.moveCamera("left"),r&&A.moveCamera("right"),i&&A.moveCamera("up"),a&&A.moveCamera("down")),A["keyCheck"+l]=!0,e.dispatchEvent&&e.dispatchEvent("moved"),e.dispatchEvent&&e.dispatchEvent("movingdone")},events:!0})),A}},this.addKeys=function(t,e,o){zot(e)&&(e="arrows"),"arrows"!=e&&(e="wasd");return zimDefaultFrame.off("keydown",A["keydown"+e]),zimDefaultFrame.off("keyup",A["keyup"+e]),A["keyCheck"+e]=!0,A["keyOjbect"+e]=t,o=zot(o)?{}:N(o),zot(o)||(A["keyFilter"+e]=o),t.boardKeyType=e,A["keydown"+e]=zimDefaultFrame.on("keydown",function(o){t.moving||A["keyCheck"+e]&&(o.keyCode==("arrows"==e?37:65)?A.move(t,-1,0,null,e):o.keyCode==("arrows"==e?39:68)?A.move(t,1,0,null,e):o.keyCode==("arrows"==e?38:87)?A.move(t,0,-1,null,e):o.keyCode==("arrows"==e?40:83)&&A.move(t,0,1,null,e),A["keyCheck"+e]=!1)}),A["keyup"+e]=zimDefaultFrame.on("keyup",function(){A["keyCheck"+e]=!0}),A},this.removeKeys=function(t){return zot(t)&&(t="arrows"),"arrows"!=t&&(t="wasd"),A["keyOjbect"+t].boardKeyType=null,A["keyOjbect"+t]=null,A["keyFilter"+t]=null,zimDefaultFrame.off("keydown",A["keydown"+t]),zimDefaultFrame.off("keyup",A["keyup"+t]),A},this.showPath=function(e,o){zot(o)&&(o=0),A.clearPath();var n=e&&e[0]&&!zot(e[0].x);t.loop(e,function(t,e){A.getTile(n?t.x:t[0],n?t.y:t[1])&&(0==o?A.getTile(n?t.x:t[0],n?t.y:t[1]).indicator.alp(1):A.getTile(n?t.x:t[0],n?t.y:t[1]).indicator.animate({props:{alpha:1},time:o,wait:e*o/10}))}),A.path=e,A.stage&&A.stage.update()},this.clearPath=function(){A.path=null,A.tiles.loop(function(t){t.indicator.alp(0)}),A.stage&&A.stage.update()},this.followPath=function(e,r,i,a,l){zot(r)||0==r.length?e.moving=!1:(e.boardPath=t.copy(r),zot(i)&&(i="seconds"==I?.6:600),(zot(a)||!0===animate)&&(a="seconds"==I?.3:300),zot(l)&&(l=0),e.moving=!0,A.moveObject=e,e.boardIntervalObj=t.interval(i,function(t){var r=e.boardPath[t.count],i=A.getTile(r.x,r.y);if(i!=e.boardTile){if(i)var s=A.getPoint(A.getTile(r.x,r.y)),c=i.boardCol,u=i.boardRow;a&&i?e.animate({props:{x:s.x,y:s.y},time:a,call:function(){if(i&&l&&l>0)var a=e.boardCol>c&&e.boardCol<=l,s=e.boardCol<c&&o-e.boardCol-1<=l,d=e.boardRow>u&&e.boardRow<=l,f=e.boardRow<u&&n-e.boardRow-1<=l;A.position(e,r.x,r.y),i&&l&&l>0&&(a&&A.moveCamera("left"),s&&A.moveCamera("right"),d&&A.moveCamera("up"),f&&A.moveCamera("down")),e.dispatchEvent&&e.dispatchEvent&&e.dispatchEvent("moved"),t.total||(e.moving=!1,e.boardLastPath=e.boardPath,e.boardPath=null,A.clearPath(),setTimeout(function(){!e.moving&&e.dispatchEvent&&e.dispatchEvent&&e.dispatchEvent("movingdone")},500))},events:!0}):(A.position(e,r.x,r.y),t.count==t.total-1&&(e.moving=!1,e.boardLastPath=e.boardPath,e.boardPath=null,A.clearPath(),e.dispatchEvent&&e.dispatchEvent("movingdone")),A.stage&&A.stage.update())}},r.length,!0))},this.stopFollowPath=function(t){t.moving=!1,t.boardIntervalObj.clear()},this.shiftPath=function(t,e,o,n,r){if(r){if(!r.boardPath)return;_(-e+t,-n+o,r)}else A.pieces.loop(function(r){r.boardPath&&_(-e+t,-n+o,r)})},this.record=function(){if("undefined"!=typeof ZIMON){if(!A.pane){var e=A.pane=new t.Pane({container:A.stage,width:Math.min(500,A.stage.width-20),height:Math.min(500,A.stage.height-20),draggable:!0}),o=A.textArea=new t.TextArea(Math.min(400,A.stage.width-70),Math.min(400,A.stage.height-70));o.tag.style.overflow="auto",o.centerReg(e)}return A.textArea.text="'"+ZIMON.stringify(A.info)+"'",A.pane.show(),A.textArea.text}}},t.extend(t.Board,t.Container),t.Person=function(e,o,n,r,i,a){var l;if(l=zob(t.Person,arguments,null,this))return l;this.arguments=arguments;var s=t.shuffle([t.pink,t.blue,t.yellow,t.green,t.tin,t.light,t.purple,t.orange]),c=t.shuffle([t.brown,"peru","saddlebrown","sandybrown","wheat","bisque","rosybrown","tan"]);zot(e)&&(e=s[0]),zot(o)&&(o=s[1]),zot(n)&&(n=c[0]),zot(r)&&(r="#333"),zot(i)&&(i=!1),zot(a)&&(a=!1),e=zik(e),o=zik(o),n=zik(n),this.super_constructor(),this.type=i?"Me":"Person";new t.Circle(12,o).sca(1,.5).addTo(this);this.centerReg(null,null,!1).mov(0,80-25/.707);new t.Rectangle(24,18,o).loc(-12,-18,this),new t.Circle(12,e,"rgba(0,0,0,.3)",2).sca(1,.5).loc(0,-18,this),new t.Rectangle(24,10,e).loc(-12,-28,this),new t.Circle(12,e).sca(1,.5).loc(0,-28,this),new t.Circle(12,n,r).loc(0,-40,this);a&&this.cache(-this.width/2-2,-this.height,this.width+4,this.height+10)},t.extend(t.Person,t.Container),t.Orb=function(e,o,n,r,i,a,l,s,c){var u;if(u=zob(t.Orb,arguments,null,this))return u;this.arguments=arguments,this.super_constructor(),this.type="Orb",zot(a)&&(a=!0),zot(e)&&(e=a?16:22),zot(o)&&(o=a?t.blue:t.purple),zot(n)&&(n=a?t.darker:null),zot(r)&&(r=a?null:t.pink),zot(i)&&(i=null),zot(l)&&(l=.5);var d="undefined"==typeof TIME?"seconds":TIME;if(zot(s)&&(s="seconds"==d?1:1e3),zot(c)&&(c="seconds"==d?1:1e3),e=zik(e),o=zik(o),n=zik(n),r=zik(r),i=zik(i),a)new t.Circle(e,o,r).alp(.9).sca(1,1).addTo(this).animate({obj:{alpha:l},time:s,loop:!0,rewind:!0}),new t.Circle(7,n,i).sca(1,1).addTo(this),this.centerReg(null,null,!1).reg(0,2);else{var f=new t.Circle(e).reg(null,14/22*e).addTo(this);if(f.colorCommand.radialGradient([o,r],[0,.8],0,0,22,8,-8,0),f.cache(),n){var h=new t.Circle(1.3*e).reg(null,14/22*e).addTo(this).alp(0);h.colorCommand.radialGradient([n,i],[0,.8],0,0,22,8,-8,0),h.cache(),h.cache().animate({props:{alpha:l},wait:c,loop:!0,rewind:!0,loopWait:c,time:s})}}},t.extend(t.Orb,t.Container),t.Tree=function(e){var o;if(o=zob(t.Tree,arguments,null,this))return o;this.arguments=arguments,zot(e)&&(e=!0),this.super_constructor(),this.type="Tree";new t.Circle(10,t.brown).sca(1,.5).addTo(this);this.centerReg(null,null,!1);new t.Rectangle(20,50,t.brown).loc(-10,-50,this),new t.Circle(t.rand(35,45),t.green).sca(1,.65).loc(0,-50,this),new t.Circle(t.rand(20,30),t.green).sca(1,1).loc(-5,-70,this),new t.Circle(t.rand(15,20),t.green).sca(1,1).loc(12,-72,this);e&&this.cache()},t.extend(t.Tree,t.Container),t.Timer=function(e,o,n,r,i,a,l,s,c,u,d,f,h,p,m,g,w,v,z,b){var C;if(C=zob(t.Timer,arguments,null,this))return C;this.arguments=arguments,zot(e)&&(e=60),zot(o)&&(o=1e3),zot(n)&&(n=!1),zot(r)&&(r=!0),zot(c)&&(c=t.black),zot(u)&&(u=t.yellow),zot(v)&&(v=150),zot(z)&&(z=60),zot(h)&&(h="center"),zot(p)&&(p="center"),zot(d)&&(d=null),zot(f)&&(f=null),d<0||f<0?d=f=null:null!=d&&null==f&&(f=1),this.super_constructor(n?t.decimals(e/60,2,2,1,null,!0):e,l,s,c,null,null,null,h,p,null,null,m,g,w,new Rectangle(v,z,u,d,f).centerReg({add:!1})),this.type="Timer";var y=this;y.totalTime=e,Object.defineProperty(this,"isometric",{get:function(){return i},set:function(t){(i=t)?(1==i&&(i="left"),"left"==i?y.ske(0,-26.5):y.ske(0,26.5)):y.ske(0,0)}});var k=a;Object.defineProperty(this,"paused",{get:function(){return k},set:function(t){t!=k&&y.pause(t)}}),this.isometric=i,Object.defineProperty(this,"time",{get:function(){return e},set:function(r){e=r,y.text=n?t.decimals(e/60,2,2,1,null,!0):t.decimals(r,zot(b)?1:b,o%1e3==0?0:zot(b)?1:b,null,!1)}}),this.start=function(e){zot(e)||(y.time=e),k=!1,clearInterval(y.intervalID),y.intervalID=setInterval(function(){y.time+=r?-o/1e3:o/1e3,r&&y.time<=0&&(y.time=0,clearInterval(y.intervalID)),y.text=n?t.decimals(y.time/60,2,2,1,null,!0):t.decimals(y.time,zot(b)?1:b,o%1e3==0?0:zot(b)?1:b,null,!1),y.dispatchEvent("step"),r&&y.time<=0&&y.dispatchEvent("complete"),y.stage&&y.stage.update()},o)},a||this.start(),this.pause=function(t){zot(t)&&(t=!0),t?(clearInterval(y.intervalID),k=!0):y.start(y.time)},this.stop=function(){clearInterval(y.intervalID),k=null}},t.extend(t.Timer,t.Label),t.Scorer=function(e,o,n,r,i,a,l,s,c,u,d,f,h,p,m){var g;if(g=zob(t.Scorer,arguments,null,this))return g;this.arguments=arguments,zot(e)&&(e=0),zot(i)&&(i=t.black),zot(a)&&(a=t.green),zot(p)&&(p=150),zot(m)&&(m=60),zot(c)&&(c="center"),zot(u)&&(u="center"),zot(l)&&(l=null),zot(s)&&(s=null),l<0||s<0?l=s=null:null!=l&&null==s&&(s=1),this.super_constructor(e,n,r,i,null,null,null,c,u,null,null,d,f,h,new Rectangle(p,m,a,l,s).centerReg({add:!1})),this.type="Scorer";var w=this;Object.defineProperty(this,"isometric",{get:function(){return o},set:function(t){1==(o=t)&&(o="right"),o?"left"==o?w.ske(0,-26.5):w.ske(0,26.5):w.ske(0,0)}}),this.isometric=o,Object.defineProperty(this,"score",{get:function(){return e},set:function(t){w.text=e=t,w.stage&&w.stage.update()}})},t.extend(t.Scorer,t.Label),t}(zim||{});window.zns||(LeaderBoard=zim.LeaderBoard,Meter=zim.Meter,Board=zim.Board,Person=zim.Person,Orb=zim.Orb,Tree=zim.Tree,Timer=zim.Timer,Scorer=zim.Scorer);
