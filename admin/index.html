<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <link href="data:image/x-icon;base64,AAABAAA==" rel="icon" type="image/x-icon" />
    <title>Admin</title>
    <style>
        .hide-me {
            display: none;
        }

        .CodeMirror {
            height: auto;
        }
    </style>
    <script class="addScript">
        function showSize() {
            var _lsTotal = 0,
                _xLen, _x;
            for (_x in localStorage) {
                if (!localStorage.hasOwnProperty(_x)) {
                    continue;
                }
                _xLen = ((localStorage[_x].length + _x.length) * 2);
                _lsTotal += _xLen;
                console.log(_x.substr(0, 50) + " = " + (_xLen / 1024).toFixed(2) + " KB")
            };
            console.log("Total = " + (_lsTotal / 1024).toFixed(2) + " KB");

        }

        var cacheJs = { config: null, loadedCounter: 0, resourcesCounter: 0, initializeDone: function () { cacheJs.config.onFinished() }, initialize: function (a) { cacheJs.getConfig(a) }, getConfig: function (a) { var b = localStorage.getItem("cacheJs.localStorageConfig"); cacheJs.config = a, null === b ? (localStorage.setItem("cacheJs.localStorageConfig", JSON.stringify(cacheJs.config)), cacheJs.checkFiles(cacheJs.config, cacheJs.config)) : cacheJs.checkFiles(cacheJs.config, JSON.parse(b)) }, checkFiles: function (a, b) { for (var c in a.files) a.files.hasOwnProperty(c) && cacheJs.resourcesCounter++; for (var c in a.files) void 0 !== a.files[c] ? b !== {} && void 0 !== b.files[c] && null !== localStorage.getItem(c) && b.files[c].version === a.files[c].version && "-" !== a.files[c].version ? cacheJs.checkIfLoaded() : cacheJs.getFile(c, a.files[c]) : void 0 !== a.files[c] && null !== localStorage.getItem(c) && cacheJs.getFile(c, a.files[c]); localStorage.setItem("cacheJs.localStorageConfig", JSON.stringify(a)) }, injectFile: function (a, b) { var c = document.createElement(b.type); c.innerHTML = localStorage.getItem(a); for (var d in b.attributes) void 0 !== b.attributes[d] && c.setAttribute(b.attributes[d].name, b.attributes[d].value); document.head.appendChild(c) }, checkIfLoaded: function () { ++cacheJs.loadedCounter === cacheJs.resourcesCounter && cacheJs.injectAllFiles() }, getFile: function (a, b) { var c = new XMLHttpRequest; c.onreadystatechange = function () { if (4 === c.readyState) if (-1 !== [304, 302, 200, 201, 202].indexOf(c.status)) localStorage.setItem(a, "/*" + a + "*/\n" + c.responseText), cacheJs.checkIfLoaded(); else if (0 === c.status) { var d = document.createElement(b.type); switch (b.type) { case "style": d.setAttribute("href", b.uri), d.setAttribute("rel", "stylesheet"); break; case "script": d.setAttribute("src", b.uri); break; default: console.warn("Unknown resource type : " + b.type) }d.onload = function () { cacheJs.checkIfLoaded() }; for (var e in b.attributes) void 0 !== b.attributes[e] && d.setAttribute(b.attributes[e].name, b.attributes[e].value); document.head.appendChild(d) } else console.warn("Unable to load Resource : " + a + "(response code " + c.status + ")", b.uri) }, c.open("GET", b.uri, !0), c.send() }, injectAllFiles: function () { for (var a in cacheJs.config.files) cacheJs.injectFile(a, cacheJs.config.files[a]); cacheJs.initializeDone() } };

        globalThis.pageLib = [{"name":"jq","type":"js","path":"/lib/jq.js","inner":false,"innerText":"","async":true}];
        globalThis.modulePath = '/assets/admin.aec4d6a0.js';
        function run(data) { eval(data) }

        function firstAppear() {
            globalThis.om = {
                swAvail: "",
                isLocalHost: "",
                isHttp: "",
                isHttps: "",
                mode: '', //Local, GitHub
                firstAppear: "",
                logStatus: "",
                token: '',
                role: '',
                serverAddress: 'http://super1mpsir-63522.portmap.io:63522',
                webAddress: 'https://mpsir.github.io/om',
                lang: 'eng', // 'hindi'
                first_meet_time: '',
                first_meet_info: '',
                name: '',
                gender: '',
                age: '',
            }


            if (window.location.protocol == "http:") {
                globalThis.om.isHttp = true
            } else { globalThis.om.isHttp = false }
            if (window.location.protocol == "https:") {
                globalThis.om.isHttps = true
            } else { globalThis.om.isHttps = false }

            if (window.location.hostname == 'localhost') {
                globalThis.om.isLocalHost = true
                globalThis.om.resolveAddress = function (address) {
                    return address
                }
            } else {
                globalThis.om.isLocalHost = false
                globalThis.om.resolveAddress = function (address) {
                    return globalThis.om.webAddress + address
                }
            }

            if ('serviceWorker' in navigator) {
                globalThis.om.swAvail = true
            }
            else { globalThis.om.swAvail = false }

            localStorage.om = JSON.stringify(globalThis.om)
            windowAppLoad()
        }

        function addScript(this_lib) {
            var head = document.getElementsByTagName('head')[0];
            var jsElm = document.createElement("script");
            jsElm.type = "application/javascript";
            jsElm.setAttribute('class', 'addScript');
            //jsElm.async = this_lib.async
            if (this_lib.inner == true) {
                jsElm.innerText = this_lib.innerText
            } else {
                //console.log(this_lib);
                jsElm.src =
                    globalThis.om.resolveAddress(this_lib.uri)
            }
            //document.body.appendChild(jsElm);
            head.appendChild(jsElm);
            // name: 'jq', type: 'js', //js, css
            //path: '/lib/jq.js', inner:true, innerText:''
            //async:true
        }

        function addStyle(this_lib) {
            var head = document.getElementsByTagName('head')[0];
            var link = document.createElement("link");
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = globalThis.om.resolveAddress(this_lib.uri);
            head.appendChild(link);
        }
        function loadModule() {
            //console.log('loading moule ...');
            const elements = document.getElementsByClassName('addScript');
            while (elements.length > 0) {
                elements[0].parentNode.removeChild(elements[0]);
            }
            globalThis.loadModuleVar = import(globalThis.om.resolveAddress(globalThis.modulePath));
        }

        function addLib() {

            for (let index = 0; index < globalThis.pageLib.length; index++) {
                const this_lib = globalThis.pageLib[index];
                switch (this_lib.type) {
                    case 'script':
                        addScript(this_lib)
                        break;

                    case 'style':
                        addStyle(this_lib)
                        break;

                    default:
                        console.log('no match for this lib');
                        console.log(this_lib);
                        break;
                }

                if (index >= globalThis.pageLib.length - 1) {
                    addScript({ // no uri
                        name: 'jqDocReady',
                        type: 'js', //js, css
                        inner: true,
                        innerText: `if (document.readyState != 'loading') { loadModule() }`,
                        async: false
                    })
                }
            }

            // if (document.readyState != 'loading') {
            //     console.log(globalThis.om.pageLib);
            // }

        }

        function windowAppLoad() {
            if (localStorage.om) {
                globalThis.om = JSON.parse(localStorage.om)

                if (window.location.hostname == 'localhost') {
                    globalThis.om.resolveAddress = function (address) {
                        return address
                    }
                } else {
                    globalThis.om.resolveAddress = function (address) {
                        return globalThis.om.webAddress + address
                    }
                }

                if (
                    window.location.hostname == 'localhost' ||
                    globalThis.om.isHttps == true
                ) {
                    addLib(); //add sw.js, 
                } else { //addLib cache.js
                    //console.log('http');
                    //console.log('yes this is http');
                    var z = {}

                    if (window.location.hostname == 'localhost' ||
                        globalThis.om.isHttp == true) {
                        var io_this = {
                            name: 'ioJs', type: 'script', version: "1", //style pr script
                            uri: '/lib/io.js', inner: false, innerText: '', async: true,
                            attributes: [{ name: "class", value: "addScript" }]
                        }
                        eval(`io_this.uri = globalThis.om.resolveAddress(io_this.uri)`)
                        eval(`z.${io_this.name} = io_this`)
                    }

                    globalThis.pageLib.forEach(lib => {
                        eval(`lib.uri = globalThis.om.resolveAddress(lib.uri)`)
                        eval(`z.${lib.name} = lib`)
                    });

                    cacheJs.initialize({
                        onFinished: function () {
                            //console.log('yes this is http');
                            loadModule()
                        },
                        files: z
                    });




                }



            }
            else { firstAppear() }
        }
    </script>
</head>

<body onload="windowAppLoad()">
    <script>
        window.addEventListener('load', function () {

            if (window.location.hostname == 'localhost') {
                navigator.serviceWorker.register('/swLocal.js')
                .then(function (registration) {
                    // Registration was successful
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function (err) {
                    // registration failed :(
                    console.log('ServiceWorker registration failed: ', err);
                });
            }

            if (window.location.protocol == "https:") {
                navigator.serviceWorker.register('https://mpsir.github.io/om/swGit.js')
                .then(function (registration) {
                    // Registration was successful
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function (err) {
                    // registration failed :(
                    console.log('ServiceWorker registration failed: ', err);
                });
            }

        });
    </script>
</body>

</html>